<script setup lang="ts">
const {$sendHaptic} = useNuxtApp()

const tapping = ref(false)
const tabLevel = ref(0)
const tap = () => {
  tabLevel.value += 1
  $sendHaptic()
  tapping.value = true
  setTimeout(() => {
    tapping.value = false
  }, 500)
}
</script>

<template>
  <div class="h-full flex justify-center items-center flex-1">
    <div id="egg" :class="{'tapped': tapping, 'step-end': tabLevel > 3 }" class="w-64" @click="tap">
      <svg
          viewBox="0 0 640 640" version="1.1" xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
      >
        <defs>
          <path
              id="path-1"
              d="M231.149861,104.68473 L222.953902,101.048367 L168.896955,109.242846 L50.1919812,0 L24.2802197,58.3236262 C24.2802197,58.3236262 6.87770271,100.906559 3.1890159,108.422385 C-0.499670906,115.938212 0.0258406394,176.176247 0.0258406394,176.176247 L3.1890159,227.439858 C3.1890159,227.439858 14.2651823,297.199291 17.9538691,309.354267 C21.6425559,321.509243 67.5136502,372.246138 67.5136502,372.246138 C67.5136502,372.246138 99.6810204,385.454545 100.206532,387.044821 C100.732043,388.635097 120.812648,400 120.812648,400 L173.677088,372.671562 L166.077383,317.974171 L203.247219,253.76551 L240.417055,253.76551 L227.147888,213.340086 L255,183.195746 L231.139755,104.715118 L231.149861,104.68473 Z"
          />
          <polygon
              id="path-3"
              points="344 50.2895476 311.124416 89.7775027 278.289293 190.740565 215.006322 213.90993 207.085835 229.14735 208.906637 251.91254 198.153792 261.976512 172.925574 273.828961 181.119181 297.463129 172.925574 293.835653 118.81742 302 0 193.024157 23.4074161 104.378346 85.5270974 37.1639454 132.655512 11.8625535 171.994942 3.95081638 248.235951 0 308.403329 11.0643067"/>
          <path
              d="M361,378.624551 L304.681162,409 L302.015722,386.545058 L218.272235,352.391669 L177.966311,366.926104 L161.841915,317.96481 L100.577316,317.96481 L8.21928692,262.906144 L6.32408759,257.456997 L1.15218833e-13,239.215522 L25.2760809,227.334761 L36.059461,217.24675 L34.2250702,194.427181 L42.1605839,179.153364 L105.563616,155.918526 L138.471168,54.7244249 L171.398989,15.1421461 L159.855503,2.42071766 L171.398989,0 L205.137591,15.1421461 L313.407187,116.093163 C313.407187,116.093163 339.585261,194.994379 347.905896,217.59112 C356.236665,240.177732 361,378.624551 361,378.624551 L361,378.624551 Z"
              id="path-5"
          />
          <polygon
              id="path-7"
              points="403.641637 129.409019 320.067144 95.2772767 279.842558 109.796683 263.750701 60.8519057 202.59962 60.8519057 108.01065 0 111.702371 11.7552517 134.30784 84.2712831 106.432819 114.403608 119.723014 154.812918 82.5124906 154.812918 45.3120811 218.995985 52.9180376 273.671574 0 300.989118 39.0108698 329.025546 62.7592552 343.241199 141.124881 348 234.530477 342.45144 352.473374 301.900378 415 225.172301"
          />
          <g id="egg_ref">
            <path
                d="M485.33781,356.694716 C479.834943,522.831092 368.361422,606.141785 234.390887,601.705958 C100.430467,597.280236 -5.29741251,506.795426 0.205454544,340.65905 C5.7083216,174.532779 120.348013,-4.34523272 254.318549,0.0804899743 C388.278969,4.50621267 490.840677,190.558341 485.33781,356.694716 Z"
                id="Path" stroke="#000000" stroke-width="22.68" fill="#F9EDD4" fill-rule="nonzero"
                stroke-linecap="round" stroke-linejoin="round"/>
            <path
                d="M454.141409,357.391919 C452.077834,420.069449 432.453639,472.612275 397.44367,509.351836 C365.053633,543.322795 320.332722,563.481052 268.106063,567.623852 C258.658126,568.371577 248.876375,568.593873 239.084509,568.260428 C179.736492,566.290072 129.452021,545.707431 93.7036167,508.725364 C76.3756548,490.820386 62.9826475,469.378871 53.7167904,444.956561 C92.9247182,475.966933 143.168727,492.780637 198.318784,494.599427 C328.79945,498.903897 437.369803,417.775752 442.731052,255.964055 C442.761399,255.21633 442.771514,254.47871 442.791746,253.720881 C451.248357,288.156641 455.254121,323.60284 454.131293,357.391919 L454.141409,357.391919 Z"
                id="Path" fill="#F4D4AB" fill-rule="nonzero"/>
            <path
                d="M273.012112,72.8523047 C305.907928,73.9435788 336.932364,85.8566543 364.982824,105.651154 C350.841265,87.0994943 335.263296,71.4376902 319.058161,59.6256586 C295.246123,42.2764215 270.321372,33.061218 244.991998,32.2225537 C240.713115,32.0810922 236.373538,32.1821361 232.084538,32.5256854 C183.813065,36.3552491 135.895636,70.2554766 97.1530242,127.981855 C62.5173315,179.595078 40.232743,243.323464 34.7703382,305.39473 C73.9883816,177.887436 167.587699,69.3662903 273.012112,72.8523047 L273.012112,72.8523047 Z"
                id="Path" fill="#FFFFFF" fill-rule="nonzero"/>
          </g>
        </defs>
        <g id="egg_hatching" stroke="none" fill="none" fill-rule="evenodd" stroke-width="1">
          <g id="bl" :class="{'flying': tabLevel > 3}" transform="translate(28, 193)">
            <mask id="mask-2" fill="white">
              <use xlink:href="#path-1"/>
            </mask>
            <g id="egg_wrap" mask="url(#mask-2)">
              <g transform="translate(27.4706, -175.3251)">
                <use xlink:href="#egg_ref"/>
                <g
                    class="cracks" transform="translate(34.2928, 42.5421)"
                    stroke-linecap="round"
                    stroke="#000000" stroke-width="12.07"
                >
                  <polyline
                      points="0 143.418587 107.143719 242.0157 161.807026 232.939985 261.482418 292.529754 322.583241 292.529754 338.661873 341.494049 378.8534 326.968853 443.006233 353.203343"
                  />
                  <polyline
                      points="170.66998 241.18511 193.246765 315.95847 165.394653 346.102811 178.673925 386.528235 141.493984 386.528235 104.324148 450.736895 111.923853 505.434287 73.8849021 525.094961"
                  />
                  <polyline
                      points="170.66998 241.18511 161.200667 213.775639 186.405009 201.89415 197.147677 191.80552 195.328599 168.984553 203.24159 153.7098 266.464671 130.483667 299.268719 29.2732337 323.563522 0"
                  />
                </g>
              </g>
            </g>
          </g>
          <g id="tl" :class="{'flying': tabLevel > 3}" transform="translate(78, 0)">
            <mask id="mask-4" fill="white">
              <use xlink:href="#path-3"/>
            </mask>
            <g id="egg_wrap" mask="url(#mask-4)">
              <g transform="translate(-22.753, 18.1377)">
                <use xlink:href="#egg_ref"/>
                <g
                    class="cracks" transform="translate(34.3253, 42.4381)" stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke="#000000" stroke-width="12.07"
                >
                  <polyline
                      points="0 143.068054 107.245214 241.424184 161.960302 232.37065 261.730114 291.814775 322.888817 291.814775 338.98268 340.659395 379.21228 326.1697 443.425883 352.34007"/>
                  <polyline
                      id="Path" stroke="#000000" stroke-width="12.07"
                      points="170.831652 240.595624 193.429823 315.186229 165.551328 345.256892 178.843179 385.583512 141.628018 385.583512 104.422972 449.635238 112.029876 504.198943 73.9548916 523.811563"/>
                  <polyline
                      id="Path" stroke="#000000" stroke-width="12.07"
                      points="170.831652 240.595624 161.353368 213.253145 186.581586 201.400696 197.334431 191.336724 195.51363 168.571534 203.434117 153.334114 266.717088 130.164748 299.55221 29.2016863 323.870027 0"/>
                </g>
              </g>
            </g>
          </g>
          <g id="tr" :class="{'flying': tabLevel > 3}" transform="translate(251, 35)">
            <mask id="mask-6" fill="white">
              <use xlink:href="#path-5"/>
            </mask>
            <g id="egg_wrap" mask="url(#mask-6)">
              <g transform="translate(-196.0397, -17.0865)">
                <use xlink:href="#egg_ref"/>
                <g
                    class="cracks" transform="translate(108.3904, 41.5395)"
                    stroke-linejoin="round"
                    stroke="#000000" stroke-width="12.07"
                >
                  <polyline
                      points="97.1557552 242.170328 87.6594891 214.762537 112.93557 202.881776 123.708815 192.793764 121.884559 169.974196 129.820073 154.700379 193.223105 131.475669 226.120522 30.2714395 250.484475 1"/>
                  <polyline
                      points="-73.7784 144.190854 33.466814 242.546984 88.181902 233.49345 187.951714 292.937575 249.110417 292.937575 265.20428 341.782195 305.43388 327.2925 369.647483 353.46287"/>
                </g>
              </g>
            </g>
          </g>
          <g id="br" :class="{'flying': tabLevel > 3}" transform="translate(149, 292)">
            <mask id="mask-8" fill="white">
              <use xlink:href="#path-7"/>
            </mask>
            <g id="egg_wrap" mask="url(#mask-8)">
              <g transform="translate(-93.4189, -274.0864)">
                <use xlink:href="#egg_ref"/>
                <g
                    class="cracks" stroke="#000000" stroke-width="12.07" stroke-linecap="round"
                    stroke-linejoin="round"
                >
                  <polyline
                      points="34.3209757 185.886532 141.552825 284.444344 196.261094 275.372247 296.018473 334.938263 357.169554 334.938263 373.261411 383.883041 413.485997 369.363634 477.691598 395.587667"/>
                  <polyline
                      points="205.131339 283.614085 227.726693 358.357641 199.851672 388.489965 213.141867 428.899276 175.931343 428.899276 138.730934 493.082343 146.336891 547.757932 108.266651 567.410768"/>
                  <polyline
                      points="205.131339 283.614085 195.654236 256.21554 220.87931 244.338787 231.630815 234.254178 229.81024 211.442308 237.72974 196.173643 301.004825 172.956768 333.835855 71.7866777 358.150641 42.5251124"/>
                </g>
              </g>
            </g>
          </g>
          <g id="broking" :class="{'hidden': tabLevel > 3}" transform="translate(89.9021, 60.453)">
            <polyline
                v-show="tabLevel > 0"
                id="s1" stroke="#000000" stroke-width="12.07" stroke-linecap="round" stroke-linejoin="round"
                points="170.604278 241.170328 161.108012 213.762537 186.384093 201.881776 197.157338 191.793764 195.333082 168.974196 203.268596 153.700379 266.671628 130.475669 299.569045 29.2714395 323.932998 0"
            />
            <polyline
                v-show="tabLevel > 1"
                id="s2" stroke="#000000" stroke-width="12.07" stroke-linecap="round" stroke-linejoin="round"
                points="0 143.347189 107.231849 241.905001 161.940118 232.832904 261.697497 292.39892 322.848578 292.39892 338.940435 341.343698 379.165022 326.824291 443.370622 353.048324"
            />
            <polygon
                v-show="tabLevel > 2"
                id="s3_1" fill="#000000" fill-rule="nonzero"
                points="161.33326 233.723913 186.03239 306.7462 230.858985 317.569942 245.878726 333.67899 284.495138 321.508609 279.134557 295.375702 261.252468 295.375702"
            />
            <polyline
                v-show="tabLevel > 2"
                id="s3" stroke="#000000" stroke-width="12.07" stroke-linecap="round" stroke-linejoin="round"
                points="170.810363 241.074742 193.405718 315.818298 165.530696 345.950622 178.820892 386.359933 141.610368 386.359933 104.409958 450.543 112.015915 505.218589 73.9456752 524.871426"
            />
          </g>
        </g>
      </svg>
    </div>
  </div>
</template>

<style scoped>
#egg.tapped {
  animation: shake 0.5s;
  animation-iteration-count: infinite;
}

@keyframes shake {
  0% {
    transform: translate(1px, 1px) rotate(0deg);
  }
  10% {
    transform: translate(-1px, -2px) rotate(-1deg);
  }
  20% {
    transform: translate(-3px, 0px) rotate(1deg);
  }
  30% {
    transform: translate(3px, 2px) rotate(0deg);
  }
  40% {
    transform: translate(1px, -1px) rotate(1deg);
  }
  50% {
    transform: translate(-1px, 2px) rotate(-1deg);
  }
  60% {
    transform: translate(-3px, 1px) rotate(0deg);
  }
  70% {
    transform: translate(3px, 1px) rotate(-1deg);
  }
  80% {
    transform: translate(-1px, -1px) rotate(1deg);
  }
  90% {
    transform: translate(1px, 2px) rotate(0deg);
  }
  100% {
    transform: translate(1px, -2px) rotate(-1deg);
  }
}

.cracks {
  opacity: 0;
}

.step-end .cracks {
  opacity: 100;
}


#tl, #tr, #bl, #br {
  transition-duration: 800ms;
}

#tl.flying {
  transform: translate(-100%, -100%);
}

#tr.flying {
  transform: translate(200%, -100%);
}

#br.flying {
  transform: translate(200%, 200%);
}


#bl.flying {
  transform: translate(-100%, 200%);
}
</style>
